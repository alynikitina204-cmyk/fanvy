<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>{{ product.name }}</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
.container { display:flex; }
.sidebar { width: 230px; background: var(--card); border-radius: var(--radius); padding:20px; box-shadow: var(--shadow-soft); }
.feed { flex:1; padding:30px; }
.detail-images { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:20px; }
.detail-images img { width:120px; height:120px; object-fit:cover; border-radius:12px; }
.product-info { background: var(--card); padding:20px; border-radius:var(--radius); box-shadow:var(--shadow-soft); }
.product-info h2 { margin-top:0; }

/* Notification badge */
.notification-badge {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
    border-radius: 12px;
    padding: 2px 8px;
    font-size: 11px;
    font-weight: 700;
    min-width: 20px;
    text-align: center;
    display: inline-block;
}
.sidebar a {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
</style>
</head>
<body>
{% include '_theme_toggle.html' %}
<div class="container">
  <div class="sidebar">
    <h3>Hi {{ session.get('username','User') }}</h3>
    <a href="/forum">Community</a>
    {% if session.user_id == 1 %}
    <a href="/shop">Shop</a>
    <a href="/cart">Cart</a>
    <a href="/purchases">My Purchases</a>
    {% endif %}
    <a href="/friends">
        <span>Friends</span>
        {% if friend_requests_count > 0 %}
        <span class="notification-badge">{{ friend_requests_count }}</span>
        {% endif %}
    </a>
    <a href="/messages">
        <span>Messages</span>
        {% if unread_messages_count > 0 %}
        <span class="notification-badge">{{ unread_messages_count }}</span>
        {% endif %}
    </a>
    <a href="/profile">Profile</a>
    <a href="/photos">Photos</a>
    <a href="/dashboard">Dashboard</a>
    <a href="/subscription">Subscription</a>
  </div>
  <div class="feed">
    <a href="/shop" style="display:inline-block;margin-bottom:20px;">&larr; Back to shop</a>

    {% if product.images %}
    <div class="detail-images">
        {% for img in product.images.split(',') %}
            <img src="{{ url_for('static', filename=img) }}">
        {% endfor %}
    </div>
    {% endif %}

    <div class="product-info">
        <h2>{{ product.name }}</h2>
        <p>{{ product.description }}</p>
        <p class="product-price">${{ '{:.2f}'.format(product.price or 0) }}</p>
        <p>
          by {{ product.username }}
          {% if product.seller_subscription == 'premium' %}
            <span class="admin-badge">ADMIN</span>
          {% endif %}
        </p>
        {% if product.file %}
        <div style="margin:12px 0;padding:10px;background:var(--soft-1);border-radius:8px;border:1px solid var(--border-soft);">
            <i class="fa-solid fa-file-zipper" style="color:var(--accent);"></i> 
            <strong>Includes downloadable file</strong>
            <div style="font-size:13px;color:var(--muted);margin-top:4px;">Available after purchase</div>
        </div>
        {% endif %}
        {% if product.user_id == session.get('user_id') %}
        <form method="POST" action="/shop/product/{{ product.id }}/delete">
            <button class="delete-product">Delete</button>
        </form>
        {% else %}
        <form action="/cart/add/{{ product.id }}">
            <button type="submit" class="edit-btn" style="font-size:14px;padding:6px 10px;">Add to cart</button>
        </form>
        {% endif %}
    </div>
  </div>
</div>
</body>
</html>